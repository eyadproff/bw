<?xml version="1.0" encoding="UTF-8"?>
<definitions id="definitions"
             targetNamespace="http://activiti.org/bpmn20"
             xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:activiti="http://activiti.org/bpmn">

    <process id="menu.register.mofaEnrollment" name="MOFA Enrollment Process">

        <startEvent id="startEvent"/>

        <sequenceFlow sourceRef="startEvent" targetRef="lookupProgress"/>

        <userTask id="lookupProgress" activiti:formKey="sa.gov.nic.bio.bw.client.features.mofaenrollment.LookupFxController"/>

        <sequenceFlow sourceRef="lookupProgress" targetRef="lookupService"/>

        <serviceTask id="lookupService" name="Calling Lookup API" activiti:class="sa.gov.nic.bio.bw.client.features.mofaenrollment.workflow.LookupService"/>

        <sequenceFlow sourceRef="lookupService" targetRef="lookupServiceResponseChecking"/>

        <exclusiveGateway id="lookupServiceResponseChecking"/>

        <sequenceFlow sourceRef="lookupServiceResponseChecking" targetRef="applicantInfoEntry">
            <conditionExpression xsi:type="tFormalExpression">
                <![CDATA[
                    ${successResponse}
                ]]>
            </conditionExpression>
        </sequenceFlow>
        <sequenceFlow sourceRef="lookupServiceResponseChecking" targetRef="lookupProgress"/>

        <userTask id="applicantInfoEntry" activiti:formKey="sa.gov.nic.bio.bw.client.features.mofaenrollment.ApplicantInfoFxController">
            <extensionElements>
            </extensionElements>
        </userTask>

        <sequenceFlow sourceRef="applicantInfoEntry" targetRef="FingerprintCapturing"/>

        <userTask id="FingerprintCapturing" activiti:formKey="sa.gov.nic.bio.bw.client.features.commons.FingerprintCapturingFxController">
            <extensionElements>
            </extensionElements>
        </userTask>

        <sequenceFlow sourceRef="FingerprintCapturing" targetRef="FingerprintCapturingDirection"/>

        <exclusiveGateway id="FingerprintCapturingDirection"/>

        <sequenceFlow sourceRef="FingerprintCapturingDirection" targetRef="applicantInfoEntry">
            <conditionExpression xsi:type="tFormalExpression">
                <![CDATA[
                    ${direction == 'backward'}
                ]]>
            </conditionExpression>
        </sequenceFlow>
        <sequenceFlow sourceRef="FingerprintCapturingDirection" targetRef="FaceCapturing"/>

        <userTask id="FaceCapturing" activiti:formKey="sa.gov.nic.bio.bw.client.features.commons.FaceCapturingFxController">
            <extensionElements>
            </extensionElements>
        </userTask>

        <sequenceFlow sourceRef="FaceCapturing" targetRef="FaceCapturingDirection"/>

        <exclusiveGateway id="FaceCapturingDirection"/>

        <sequenceFlow sourceRef="FaceCapturingDirection" targetRef="FingerprintCapturing">
            <conditionExpression xsi:type="tFormalExpression">
                <![CDATA[
                    ${direction == 'backward'}
                ]]>
            </conditionExpression>
        </sequenceFlow>
        <sequenceFlow sourceRef="FaceCapturingDirection" targetRef="SummaryReviewing"/>

        <userTask id="SummaryReviewing" activiti:formKey="sa.gov.nic.bio.bw.client.features.mofaenrollment.SummaryFxController">
            <extensionElements>
            </extensionElements>
        </userTask>

        <sequenceFlow sourceRef="SummaryReviewing" targetRef="SummaryReviewingDirection"/>

        <exclusiveGateway id="SummaryReviewingDirection"/>

        <sequenceFlow sourceRef="SummaryReviewingDirection" targetRef="FaceCapturing">
            <conditionExpression xsi:type="tFormalExpression">
                <![CDATA[
                    ${direction == 'backward'}
                ]]>
            </conditionExpression>
        </sequenceFlow>
        <sequenceFlow sourceRef="SummaryReviewingDirection" targetRef="Done"/>

        <userTask id="Done" activiti:formKey="sa.gov.nic.bio.bw.client.features.mofaenrollment.DoneFxController">
            <extensionElements>
            </extensionElements>
        </userTask>

        <sequenceFlow sourceRef="Done" targetRef="applicantInfoEntry"/>

        <endEvent id="endEvent" />

    </process>

</definitions>