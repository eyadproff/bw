<?xml version="1.0" encoding="UTF-8"?>
<definitions id="definitions"
             targetNamespace="http://activiti.org/bpmn20"
             xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:activiti="http://activiti.org/bpmn">

    <error id="B02-1000" errorCode="B02-1000" name="Wrong Username/Password"/>

    <process id="loginProcess" name="Login Process">

        <startEvent id="startEvent"/>

        <sequenceFlow sourceRef="startEvent" targetRef="userCredentialsEntry"/>

        <userTask id="userCredentialsEntry" activiti:formKey="sa.gov.nic.bio.bw.client.login.LoginPaneFxController">
            <extensionElements>
                <activiti:formProperty id="username" type="string" required="true"/>
                <activiti:formProperty id="password" type="string" required="true"/>
            </extensionElements>
        </userTask>

        <sequenceFlow sourceRef="userCredentialsEntry" targetRef="loginService"/>

        <serviceTask id="loginService" name="Calling Login API"
                     activiti:class="sa.gov.nic.bio.bw.client.login.workflow.LoginService"/>

        <boundaryEvent id="catchingLoginError" name="Catching Login Errors" attachedToRef="loginService">
            <errorEventDefinition errorRef="B02-1000"/>
        </boundaryEvent>

        <sequenceFlow sourceRef="catchingLoginError" targetRef="userCredentialsEntry"/>

        <sequenceFlow sourceRef="loginService" targetRef="endEvent"/>

        <exclusiveGateway id="loginCheck" name="Login Check"/>

        <sequenceFlow sourceRef="loginCheck" targetRef="userCredentialsEntry">
            <conditionExpression xsi:type="tFormalExpression">${!successfulLogin}</conditionExpression>
        </sequenceFlow>

        <sequenceFlow sourceRef="loginCheck" targetRef="script">
            <conditionExpression xsi:type="tFormalExpression">${successfulLogin}</conditionExpression>
        </sequenceFlow>

        <scriptTask id="script" scriptFormat="JavaScript">
            <script>
                print("Hello World");
            </script>
        </scriptTask>

        <endEvent id="endEvent" />

    </process>

</definitions>